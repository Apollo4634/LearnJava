# JDBC的接口和类

JDBC的接口和类由`java.sql`模块定义，模块关系图如下：

![img](https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/module-graph.png)

**What the JDBC™ 4.3 API Includes**  
The JDBC 4.3 API includes both the java.sql package, referred to as the **JDBC core API**, and the **javax.sql package**, referred to as the JDBC Optional Package API. This complete JDBC API is included in the Java Standard Edition (Java SE), version 7. The javax.sql package extends the functionality of the JDBC API from a client-side API to a server-side API, and it is an essential part of the Java Enterprise Edition (Java EE) technology. 简单来说就是，JDBC主要包含核心包`java.sql`和扩展包`javax.sql`。

顺带一提，Java 8支持JDBC 4.2，而从Java 9开始是JDBC 4.3。

### JDBC编程步骤

整体步骤可以参考`JDBC基础.md`中的JDBC访问示意图。具体步骤如下：

* 加载数据库驱动
* 通过DriverManager获取数据库连接
* 通过Connection对象创建Statement对象
* 使用Statement执行SQL语句
* 操作结果集

1）**加载数据库驱动**

通常使用Class类的静态方法forName()来加载，该方法如下：

```
public static Class<?> forName(Module module, String name)
public static Class<?> forName(String name, boolean initialize, ClassLoader loader) throws ClassNotFoundException
public static Class<?> forName(String className) throws ClassNotFoundException
```

最新的JDBC驱动已经可以通过SPI自动注册驱动类了，在JDBC驱动JAR包的META-INF\services路径下会包含一个`java.sql.Driver`文件，该文件制定了JDBC驱动类。因此，使用这种Jar包时这一步可以省略。

2）**通过DriverManager获取数据库连接**

主要通过DriverManager的静态方法getConnection获取，具体如下：

```
public static Driver getDriver(String url) throws SQLException
public static Connection getConnection(String url) throws SQLException
public static Connection getConnection(String url, String user, String password) throws SQLException

Parameters:
url - a database url of the form jdbc:subprotocol:subname
user - the database user on whose behalf the connection is being made
password - the user's password

url examples:
1 jdbc:sql//hostname:port/databasename
2 jdbc:oracle:thin:@hostname:port:databasename
```

3）**通过Connection对象创建Statement对象**

创建的方法包括createStatement、prepareStatement、prepareCall，具体如下：

```
创建Statement
1 Statement createStatement() throws SQLException
2 Statement createStatement(int resultSetType, int resultSetConcurrency) throws SQLException
3 Statement createStatement(int resultSetType, int resultSetConcurrency, int resultSetHoldability) throws SQLException

创建PreparedStatement
1 PreparedStatement prepareStatement(String sql) throws SQLException
2 PreparedStatement prepareStatement(String sql, int autoGeneratedKeys) throws SQLException
3 PreparedStatement prepareStatement(String sql, int[] columnIndexes) throws SQLException
4 PreparedStatement prepareStatement(String sql, int resultSetType, int resultSetConcurrency, int resultSetHoldability) throws SQLException
5 PreparedStatement prepareStatement​(String sql, int resultSetType, int resultSetConcurrency, int resultSetHoldability) throws SQLException

创建CallableStatement
1 CallableStatement prepareCall(String sql) throws SQLException
2 CallableStatement prepareCall(String sql, int resultSetType, int resultSetConcurrency) throws SQLException
3 CallableStatement prepareCall(String sql, int resultSetType, int resultSetConcurrency, int resultSetHoldability) throws SQLException
```

Statement、PreparedStatement和CallableStatement都是接口（interface）。Statement用于执行不带参数的简单SQL语句，并返回它所生成的结果，每次执行SQL语句时，数据库都要编译该SQL语句。

关于PreparedStatement可以查阅参考资料给出的链接。PreparedStatement对象不仅包含了SQL语句，而且大多数情况下这个语句已经被预编译过，因而当其执行时，只需DBMS运行SQL语句，而不必先编译。当你需要执行Statement对象多次的时候，PreparedStatement对象将会大大降低运行时间，当然也加快了访问数据库的速度。总而言之，PreparedStatement是可变参数的SQL，编译一次，执行多次，效率高；安全性好，有效防止Sql注入等问题；支持批量更新，批量删除。

CallableStatement继承自PreparedStatement，支持带参数的SQL操作；支持调用存储过程，提供了对输出和输入/输出参数(INOUT)的支持。

关于存储过程可以参考本模块下mysql中的相关内容。

4）**使用Statement执行SQL语句**

鉴于Statement、PreparedStatement和CallableStatement三个接口之间的继承关系，可知三者都有Statement接口的相关方法。

```
public interface PreparedStatement extends Statement
public interface CallableStatement extends PreparedStatement
```

Statement的几个常用方法如下：

```
boolean execute() throws SQLException
int executeUpdate() throws SQLException
ResultSet executeQuery() throws SQLException
```











<br>

---

**参考资料**

1. 《疯狂Java讲义（第4版）》李刚，电子工业出版社，第13章
2.     [Module - java.sql (Java SE 11 & JDK 11 )](https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/module-summary.html)
3.    [Class - java.sql.DriverManager (Java SE 11 & JDK 11 )](https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/DriverManager.html)
4.   [Interface - java.sql.Connection (Java SE 11 & JDK 11 )](https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/Connection.html)
5.  [JDBC中的Statement和PreparedStatement的区别](https://blog.csdn.net/jiangwei0910410003/article/details/26143977)
6.  [Interface - java.sql.Statement (Java SE 11 & JDK 11 )](https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/Statement.html)

