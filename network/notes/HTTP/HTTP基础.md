# HTTP基础

HTTP协议是TCP/IP协议族中的一部分，是**基于TCP的应用层协议**，它不关心数据传输的细节，主要是用来规定客户端和服务端的数据传输格式，最初是用来向客户端传输HTML页面的内容。默认端口是80。

HTTP不保存状态，是一种**无状态协议**。HTTP协议自身不对请求和相应之间的通信状态进行保存，也就是说该协议对于发送过的请求或相应都不做持久化处理。

（注：这里并不追求知识点全面，只是选择性的记录部分知识点）

## 几个历史版本

### **HTTP 1.0**　1996年

1.0版本是改变比较大的，奠定了现在HTTP协议的基础。这个版本的协议不仅**可以传输HTML的文本页面**，还**可以传输其他二进制文件**，例如图片、视频。而且还增加了现在常用的POST和HEAD命令。请求消息和响应消息也不是单一的了，规定了一些元数据字段。例如字符集、编码、状态响应码等。

### **HTTP 1.1**　1997年

实际上是在1.0版本之后半年时间又发布了一个版本，这个版本在1.0版本的基础上更加完善了。

这个版本增加了**持久连接**，就是说之前版本的协议一次请求就是一次TCP连接，请求完成后这个连接就关闭掉了。众所周知TCP协议是可靠的，建立连接需要3次握手，断开连接需要4次挥手，并且TCP有流量控制和拥塞控制，有慢开始机制，刚建立连接时传输比较慢，这是比较耗费资源的。一个丰富的页面会有许多图片、表单和超链接。这样的话就会有多次的HTTP请求，所以在这个版本上默认不关闭TCP连接也不用声明Connection: keep-alive字段。如果确实要关闭可以指定Connection: close字段。

另外1.1版本还引入了**管道机制**，就是说在一个TCP连接里可以同时发送多个HTTP请求，而不必等待上一个请求响应成功再发送。还增加了PUT、PATCH、HEAD、 OPTIONS、DELETE等命令，丰富了客户端和服务端交互动作。还增加了Host字段。

### **HTTP 2**　　2015年

这个版本是对1.1版本的完善。1.1版本有了管道机制，但是正在服务端还是要对请求进行排队处理。这个版本可以多工的处理。还有了头信息压缩和服务器的主动推送。

## 消息结构

HTTP是基于客户端/服务端（C/S）的架构模型。协议规定，请求从客户端发出，最后服务端相应请求并返回。也就是说，肯定是从客户端开始建立通信。

HTTP使用统一资源标识符（Uniform Resource Identifiers, URI）来传输数据和建立连接。一旦建立连接后，数据消息就通过类似Internet邮件所使用的格式[`RFC5322`]和多用途Internet邮件扩展（MIME）[`RFC2045`]来传送。

### 客户端请求与服务器响应

用于HTTP协议交互的信息称为HTTP报文。客户端发出的是请求报文，服务端发出的是响应报文。

```
HTTP报文结构：

报文首部
空行（CR+LF）
报文主体
```



请求包含四个部分：请求行（request line）、请求头部（header）、空行和请求数据。

响应包含四个部分：状态行、消息报头、空行和响应正文。

```
客户端请求：

GET /hello.txt HTTP/1.1 （请求行）
User-Agent: curl/7.16.3 libcurl/7.16.3 OpenSSL/0.9.7l zlib/1.2.3
Host: www.example.com
Accept-Language: en, mi
（空行）
（请求数据，此例无）

服务端响应:
HTTP/1.1 200 OK （状态行）
Date: Mon, 27 Jul 2009 12:28:53 GMT
Server: Apache
Last-Modified: Wed, 22 Jul 2009 19:15:56 GMT
ETag: "34aa387-d-1568eb00"
Accept-Ranges: bytes
Content-Length: 51
Vary: Accept-Encoding
Content-Type: text/plain
（空行）
（正文，此例无）
```

